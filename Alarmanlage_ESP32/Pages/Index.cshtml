@page
@model Alarmanlage_ESP32.Pages.IndexModel

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <title>Smart Home Dashboard</title>
    <style>
        body {
            font-family: Arial;
            margin: 2rem;
        }

        .card {
            border: 1px solid #ccc;
            padding: 1rem;
            margin: 0.5rem;
            display: inline-block;
        }

        .alarm {
            color: red;
            font-weight: bold;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 1rem;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 0.5rem;
            text-align: left;
        }

        tbody {
            max-height: 200px;
            display: block;
            overflow-y: auto;
        }

            thead, tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }
    </style>
</head>
<body>
    <h1>Smart Home Dashboard</h1>

    <div class="card">Temperatur: <span id="temp">@Model.Temp</span> °C</div>
    <div class="card">Luftfeuchtigkeit: <span id="hum">@Model.Hum</span> %</div>
    <div class="card">Bewegung: <span id="motion">@Model.Motion</span></div>
    <div class="card">Licht: <span id="light">@Model.Light</span></div>
    <div class="card alarm">Alarm: <span id="alarm">@Model.Alarm</span></div>

    <form method="post" asp-page-handler="DisableAlarm">
        <button type="submit">Alarm deaktivieren</button>
    </form>

    <h2>Historie</h2>
    <table>
        <thead>
            <tr><th>Zeit</th><th>Daten</th></tr>
        </thead>
        <tbody id="historyBody">
            @foreach (var log in IndexModel.History)
            {
                <tr>
                    <td>@log.Substring(0, 8)</td>
                    <td>@log.Substring(11)</td>
                </tr>
            }
        </tbody>
    </table>

    <script>
        async function fetchData() {
            const response = await fetch(window.location.href);
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            document.getElementById('temp').innerText = doc.getElementById('temp').innerText;
            document.getElementById('hum').innerText = doc.getElementById('hum').innerText;
            document.getElementById('motion').innerText = doc.getElementById('motion').innerText;
            document.getElementById('light').innerText = doc.getElementById('light').innerText;
            document.getElementById('alarm').innerText = doc.getElementById('alarm').innerText;

            // Update History
            const newBody = doc.getElementById('historyBody');
            document.getElementById('historyBody').innerHTML = newBody.innerHTML;
        }

        setInterval(fetchData, 2000);
    </script>
</body>
</html>
